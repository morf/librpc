SET(BINARY_DIR @CMAKE_BINARY_DIR@)

execute_process(COMMAND "git" describe --dirty --always
    OUTPUT_VARIABLE GIT_VERSION
    OUTPUT_STRIP_TRAILING_WHITESPACE
    ERROR_QUIET)

execute_process(COMMAND "git" rev-list --count HEAD
    OUTPUT_VARIABLE GIT_REVNUM
    OUTPUT_STRIP_TRAILING_WHITESPACE
    ERROR_QUIET)

if(GIT_VERSION STREQUAL "")
    message(WARNING "Error retrieving revision number from git")

    SET(GIT_VERSION "notgit")
    SET(GIT_REVNUM "0")
endif()

set(CPACK_OUTPUT_FILE_PREFIX "${BINARY_DIR}/package")

set(CPACK_PACKAGE_VERSION_MAJOR "3")
set(CPACK_PACKAGE_VERSION_MINOR "2")
set(CPACK_PACKAGE_VERSION_PATCH "${GIT_REVNUM}.${GIT_VERSION}")
set(CPACK_PACKAGE_VERSION "${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}.${CPACK_PACKAGE_VERSION_PATCH}")
set(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}.${CPACK_PACKAGE_VERSION_PATCH}")

SET(CPACK_DEBIAN_PACKAGE_DEPENDS "libevent-dev (>= 2.1)")
set(CPACK_PACKAGE_CONTACT "Andrey Kolyshkin <a.kolyshkin@semrush.com>")
set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "Library for rpc call use libevent")
